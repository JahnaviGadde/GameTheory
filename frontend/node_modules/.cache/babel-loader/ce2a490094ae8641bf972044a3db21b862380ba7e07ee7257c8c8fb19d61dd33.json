{"ast":null,"code":"import React,{useEffect,useState,useContext}from\"react\";import NavbarUser from\"../components/NavbarUser\";import{useParams,useNavigate}from\"react-router-dom\";import axios from\"axios\";import{AuthContext}from\"../context/AuthContext\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function Bookslots(){const{bookingId}=useParams();const navigate=useNavigate();const context=useContext(AuthContext);const[formData,setFormData]=useState({});const username=context.user.user.name;// Fetch booking data on page load\nuseEffect(()=>{const fetchBooking=async()=>{try{var _booking$courtId,_booking$sportId,_booking$centerId;const response=await axios.get(\"\".concat(process.env.REACT_APP_BACKENDAPI,\"/api/booking/\").concat(bookingId));const booking=response.data;setFormData({courtName:(_booking$courtId=booking.courtId)===null||_booking$courtId===void 0?void 0:_booking$courtId.name,sportName:(_booking$sportId=booking.sportId)===null||_booking$sportId===void 0?void 0:_booking$sportId.name,centerName:(_booking$centerId=booking.centerId)===null||_booking$centerId===void 0?void 0:_booking$centerId.name,bookingDate:new Date(booking.date).toISOString().split(\"T\")[0],bookingSlot:booking.bookingSlot});}catch(error){console.error(\"Error fetching booking data:\",error);alert(\"Could not load the booking data.\");}};fetchBooking();},[bookingId]);const handleSubmit=async e=>{e.preventDefault();try{var _context$user,_context$user$user,_context$user2,_context$user2$user;const response=await axios.put(\"\".concat(process.env.REACT_APP_BACKENDAPI,\"/api/booking/book/\").concat(bookingId),{userId:context===null||context===void 0?void 0:(_context$user=context.user)===null||_context$user===void 0?void 0:(_context$user$user=_context$user.user)===null||_context$user$user===void 0?void 0:_context$user$user.id,customername:context===null||context===void 0?void 0:(_context$user2=context.user)===null||_context$user2===void 0?void 0:(_context$user2$user=_context$user2.user)===null||_context$user2$user===void 0?void 0:_context$user2$user.name},{headers:{Authorization:\"Bearer \".concat(context.user.token),'Content-Type':'application/json'}});alert(response.data.message);navigate(\"/dashboard/\".concat(username));}catch(error){var _error$response,_error$response2,_error$response2$data;console.error(\"Error booking slot:\",error);if(((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)===400||((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.message)===\"Invalid token\"){alert(\"Your session has expired. Please log in again.\");navigate('/');}else{var _error$response3,_error$response3$data;alert(((_error$response3=error.response)===null||_error$response3===void 0?void 0:(_error$response3$data=_error$response3.data)===null||_error$response3$data===void 0?void 0:_error$response3$data.message)||\"An error occurred. Please try again.\");}}};if(!formData.courtName)return/*#__PURE__*/_jsx(\"div\",{children:\"Loading...\"});// Wait until data is loaded\nreturn/*#__PURE__*/_jsxs(\"div\",{className:\"centreschedule\",children:[/*#__PURE__*/_jsx(NavbarUser,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-container\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Book Slot\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Center\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:formData.centerName,readOnly:true})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Court\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:formData.courtName,readOnly:true})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Sport\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:formData.sportName,readOnly:true})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Date\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:formData.bookingDate,readOnly:true})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Time Slot\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:formData.bookingSlot,readOnly:true})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"submit-button\",children:\"Confirm Booking\"})]})]})]});}","map":{"version":3,"names":["React","useEffect","useState","useContext","NavbarUser","useParams","useNavigate","axios","AuthContext","jsx","_jsx","jsxs","_jsxs","Bookslots","bookingId","navigate","context","formData","setFormData","username","user","name","fetchBooking","_booking$courtId","_booking$sportId","_booking$centerId","response","get","concat","process","env","REACT_APP_BACKENDAPI","booking","data","courtName","courtId","sportName","sportId","centerName","centerId","bookingDate","Date","date","toISOString","split","bookingSlot","error","console","alert","handleSubmit","e","preventDefault","_context$user","_context$user$user","_context$user2","_context$user2$user","put","userId","id","customername","headers","Authorization","token","message","_error$response","_error$response2","_error$response2$data","status","_error$response3","_error$response3$data","children","className","onSubmit","type","value","readOnly"],"sources":["C:/Users/Dell/Desktop/task/GameTheory/frontend/src/pages/Bookslots.jsx"],"sourcesContent":["import React, { useEffect, useState, useContext } from \"react\";\r\nimport NavbarUser from \"../components/NavbarUser\";\r\nimport { useParams, useNavigate } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport { AuthContext } from \"../context/AuthContext\";\r\n\r\nexport default function Bookslots() {\r\n  const { bookingId } = useParams(); \r\n  const navigate = useNavigate(); \r\n  const context = useContext(AuthContext);\r\n  const [formData, setFormData] = useState({}); \r\n  const username = context.user.user.name;\r\n\r\n  // Fetch booking data on page load\r\n  useEffect(() => {\r\n    const fetchBooking = async () => {\r\n      try {\r\n        const response = await axios.get(\r\n          `${process.env.REACT_APP_BACKENDAPI}/api/booking/${bookingId}`\r\n        );\r\n\r\n        const booking = response.data;\r\n\r\n        setFormData({\r\n          courtName: booking.courtId?.name,\r\n          sportName: booking.sportId?.name,\r\n          centerName: booking.centerId?.name,\r\n          bookingDate: new Date(booking.date).toISOString().split(\"T\")[0],\r\n          bookingSlot: booking.bookingSlot,\r\n        });\r\n      } catch (error) {\r\n        console.error(\"Error fetching booking data:\", error);\r\n        alert(\"Could not load the booking data.\");\r\n      }\r\n    };\r\n\r\n    fetchBooking();\r\n  }, [bookingId]);\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n\r\n    try {\r\n      const response = await axios.put(\r\n        `${process.env.REACT_APP_BACKENDAPI}/api/booking/book/${bookingId}`,\r\n        {\r\n          userId: context?.user?.user?.id, \r\n          customername: context?.user?.user?.name,\r\n        },\r\n        \r\n        {\r\n            headers: {\r\n              Authorization: `Bearer ${context.user.token}`,\r\n              'Content-Type': 'application/json',\r\n            },\r\n        }\r\n      );\r\n\r\n      alert(response.data.message); \r\n      navigate(`/dashboard/${username}`); \r\n    } catch (error) {\r\n        console.error(\"Error booking slot:\", error);\r\n        if (error.response?.status === 400 || error.response?.data?.message === \"Invalid token\") {\r\n          alert(\"Your session has expired. Please log in again.\");\r\n          navigate('/');\r\n        } else {\r\n          alert(\r\n            error.response?.data?.message || \"An error occurred. Please try again.\"\r\n          );\r\n        }\r\n    }\r\n  };\r\n\r\n  if (!formData.courtName) return <div>Loading...</div>; // Wait until data is loaded\r\n\r\n  return (\r\n    <div className=\"centreschedule\">\r\n      <NavbarUser />\r\n      <div className=\"form-container\">\r\n        <h2>Book Slot</h2>\r\n        <form onSubmit={handleSubmit}>\r\n          <div>\r\n            <label>Center</label>\r\n            <input type=\"text\" value={formData.centerName} readOnly />\r\n          </div>\r\n          <div>\r\n            <label>Court</label>\r\n            <input type=\"text\" value={formData.courtName} readOnly />\r\n          </div>\r\n          <div>\r\n            <label>Sport</label>\r\n            <input type=\"text\" value={formData.sportName} readOnly />\r\n          </div>\r\n          <div>\r\n            <label>Date</label>\r\n            <input type=\"date\" value={formData.bookingDate} readOnly />\r\n          </div>\r\n          <div>\r\n            <label>Time Slot</label>\r\n            <input type=\"text\" value={formData.bookingSlot} readOnly />\r\n          </div>\r\n          <button type=\"submit\" className=\"submit-button\">\r\n            Confirm Booking\r\n          </button>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}